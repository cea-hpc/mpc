##########################################################################

#Setup vars
@PACKAGE_VAR_NAME@_NAME=@PACKAGE_NAME@
@PACKAGE_VAR_NAME@_VERSION=@PACKAGE_VERSION@
@PACKAGE_VAR_NAME@_FULL_NAME=@PACKAGE_NAME@-$(@PACKAGE_VAR_NAME@_VERSION)
@PACKAGE_VAR_NAME@_STEP_NAME=$(@PACKAGE_VAR_NAME@_FULL_NAME) for @SUBPREFIX@
@PACKAGE_VAR_NAME@_SOURCE_DIR=$(@PACKAGE_VAR_NAME@_FULL_NAME)
@PACKAGE_VAR_NAME@_BUILD_DIR=$(@PACKAGE_VAR_NAME@_SOURCE_DIR)
@PACKAGE_VAR_NAME@_BUILD_PARAMETERS=@PACKAGE_OPTIONS@ @USER_PARAMETERS@
@PACKAGE_VAR_NAME@_PATCH_FILE=$(PROJECT_PACKAGE_DIR)/@PACKAGE_NAME@/mpc-$(@PACKAGE_VAR_NAME@_FULL_NAME).patch

@PACKAGE_NAME@-gen-help: @PACKAGE_NAME@-prepare
	cd $(@PACKAGE_VAR_NAME@_BUILD_DIR) && $(STEP_WRAPPER) "Generate help $(@PACKAGE_VAR_NAME@_STEP_NAME)" ./configure --help > $(PROJECT_HELP_DIR)/$(@PACKAGE_VAR_NAME@_FULL_NAME)-help.txt

@PACKAGE_NAME@-prepare: $(PROJECT_PACKAGE_DIR)/$(@PACKAGE_VAR_NAME@_NAME)/$(@PACKAGE_VAR_NAME@_FULL_NAME).tar.*
	if test ! -d "/$(PWD)/@SUBPREFIX@/$(@PACKAGE_VAR_NAME@_SOURCE_DIR)";  \
	then \
		$(STEP_WRAPPER) "Extract $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(TAR) -xf $(PROJECT_PACKAGE_DIR)/$(@PACKAGE_VAR_NAME@_NAME)/$(@PACKAGE_VAR_NAME@_FULL_NAME).tar.*; \
		if test -f $(@PACKAGE_VAR_NAME@_PATCH_FILE); \
		then \
			cd $(@PACKAGE_VAR_NAME@_SOURCE_DIR) && $(STEP_WRAPPER) "Patch $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(PATCH) -p1 < $(@PACKAGE_VAR_NAME@_PATCH_FILE); \
		fi; \
	fi; \

@PACKAGE_NAME@: @PACKAGE_DEPS@ @PACKAGE_NAME@-prepare
	cd $(@PACKAGE_VAR_NAME@_BUILD_DIR) && $(STEP_WRAPPER) "Configure $(@PACKAGE_VAR_NAME@_STEP_NAME)" ./configure --prefix=$(PREFIX) $(@PACKAGE_VAR_NAME@_BUILD_PARAMETERS)
	$(STEP_WRAPPER) "Build $(@PACKAGE_VAR_NAME@_STEP_NAME)"   $(MAKE) $(MFLAGS) -C $(@PACKAGE_VAR_NAME@_BUILD_DIR)
	$(STEP_WRAPPER) "Install $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(MAKE) $(MFLAGS) -C $(@PACKAGE_VAR_NAME@_BUILD_DIR) install
	export LD_LIBRARY_PATH=$(PREFIX)/lib:$(LD_LIBRARY_PATH)

#avoid conflict with directory
.PHONY: @PACKAGE_NAME@ @PACKAGE_NAME@-prepare @PACKAGE_NAME@-gen-help
