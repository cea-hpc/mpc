#!/bin/sh
MPC_INSTALL_DIR_PREFIX="@PREFIX@"
SHELL_NAME="${0}"
if test "${0}"  = "-bash"; then
SHELL_NAME="bash"
fi

if test "${SHELL_NAME}" = "bash" -o "${SHELL_NAME}" = "sh" ; then
	SCRIPT=$(cd `dirname "${BASH_SOURCE[0]}"` && pwd)/`basename "${BASH_SOURCE[0]}"`
else
	#SCRIPT=$(cd `dirname "${0}"` && pwd)/`basename "${0}"`
	SCRIPT="${MPC_INSTALL_DIR_PREFIX}/mpcvars.sh"
fi

#Delete previous entry if exists
if test ! -z "${MPC_RPREFIX}" ; then
echo "del"
	mpc_rprefix=`echo "$MPC_RPREFIX" | sed -e 's/\//\\\\\//g'`
	PATH=`echo ${PATH} | awk -v RS=: -v ORS=: '/'"$mpc_rprefix"'/ {next} {print}' | sed 's/:*$//'`
	LD_LIBRARY_PATH=`echo ${LD_LIBRARY_PATH} | awk -v RS=: -v ORS=: '/'"$mpc_rprefix"'/ {next} {print}' | sed 's/:*$//'`
	LIBRARY_PATH=`echo ${LIBRARY_PATH} | awk -v RS=: -v ORS=: '/'"$mpc_rprefix"'/ {next} {print}' | sed 's/:*$//'`
	MANPATH=`echo ${MANPATH} | awk -v RS=: -v ORS=: '/'"$mpc_rprefix"'/ {next} {print}' | sed 's/:*$//'`
fi

SCRIPTPATH=$(dirname "$SCRIPT")
MPC_INSTALL_DIR_PREFIX="$SCRIPTPATH"
export MPC_INSTALL_DIR_PREFIX

MPC_RPREFIX="$SCRIPTPATH"
export MPC_RPREFIX
. "${MPC_RPREFIX}/.Architectures.sh"

uname=`uname -m`
getArch host "${uname}"
if test "$#" = "1" -a "$0" != "bash" ; then
	getArch target "${1}"
else 
    target=${host}
fi

if test "${host}" = "0" -o "${target}" = "0"; then
	echo "######################################################################"
	echo "# You don't have any installation for the architecture ${host}/${target}"
	echo "######################################################################"
else	
	echo "load ${host}/${target} module (${MPC_RPREFIX})"
   	. "${MPC_RPREFIX}/${target}/${target}/bin/mpcvars.sh"
       
    MPC_HOST_SUBPREFIX="${host}"
    export MPC_HOST_SUBPREFIX
    MPC_TARGET_SUBPREFIX="${target}" 
    export MPC_TARGET_SUBPREFIX
fi

