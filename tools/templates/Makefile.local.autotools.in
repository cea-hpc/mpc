##########################################################################

#Setup vars
@PACKAGE_VAR_NAME@_NAME=@PACKAGE_NAME@
@PACKAGE_VAR_NAME@_VERSION=@PACKAGE_VERSION@
@PACKAGE_VAR_NAME@_FULL_NAME=@PACKAGE_NAME@-@PACKAGE_VERSION@
@PACKAGE_VAR_NAME@_STEP_NAME=$(@PACKAGE_VAR_NAME@_FULL_NAME)@SUBPREFIX@
@PACKAGE_VAR_NAME@_SOURCE_DIR=$(PROJECT_SOURCE_DIR)/@PACKAGE_NAME@
@PACKAGE_VAR_NAME@_BUILD_DIR=$(PROJECT_BUILD_DIR)@SUBPREFIX@/@PACKAGE_NAME@
@PACKAGE_VAR_NAME@_BUILD_PARAMETERS=@PACKAGE_OPTIONS@ @USER_PARAMETERS@

@PACKAGE_NAME@-gen-help:
	cd $(@PACKAGE_VAR_NAME@_BUILD_DIR) && $(STEP_WRAPPER) "Generate help $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(@PACKAGE_VAR_NAME@_SOURCE_DIR)/configure --help > $(PROJECT_HELP_DIR)/$(@PACKAGE_VAR_NAME@_FULL_NAME)-help.txt

@PACKAGE_NAME@: @PACKAGE_DEPS@
	if test -d "/$(@PACKAGE_VAR_NAME@_BUILD_DIR)"; then $(STEP_WRAPPER) "Cleanup previous workdir $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(RM) -rf "/$(@PACKAGE_VAR_NAME@_BUILD_DIR)"; fi
	mkdir -p $(@PACKAGE_VAR_NAME@_BUILD_DIR)
	cd $(@PACKAGE_VAR_NAME@_BUILD_DIR) && $(STEP_WRAPPER) "Configure $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(@PACKAGE_VAR_NAME@_SOURCE_DIR)/configure --prefix=$(PREFIX) $(@PACKAGE_VAR_NAME@_BUILD_PARAMETERS)
	$(STEP_WRAPPER) "Build $(@PACKAGE_VAR_NAME@_STEP_NAME)"   $(MAKE) $(MFLAGS) -C $(@PACKAGE_VAR_NAME@_BUILD_DIR)
	#$(STEP_WRAPPER) "Test $(@PACKAGE_VAR_NAME@_STEP_NAME)"    $(MAKE) $(MFLAGS) -C $(@PACKAGE_VAR_NAME@_BUILD_DIR) test
	$(STEP_WRAPPER) "Install $(@PACKAGE_VAR_NAME@_STEP_NAME)" $(MAKE) $(MFLAGS) -C $(@PACKAGE_VAR_NAME@_BUILD_DIR) install

#avoid conflict with directory
.PHONY: @PACKAGE_NAME@ @PACKAGE_NAME@-gen-help
