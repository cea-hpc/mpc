#!/bin/sh
############################# MPC License ############################## 
# Wed Nov 19 15:19:19 CET 2008                                         # 
# Copyright or (C) or Copr. Commissariat a l'Energie Atomique          # 
#                                                                      # 
# IDDN.FR.001.230040.000.S.P.2007.000.10000                            # 
# This file is part of the MPC Runtime.                                # 
#                                                                      # 
# This software is governed by the CeCILL-C license under French law   # 
# and abiding by the rules of distribution of free software.  You can  # 
# use, modify and/ or redistribute the software under the terms of     # 
# the CeCILL-C license as circulated by CEA, CNRS and INRIA at the     # 
# following URL http://www.cecill.info.                                # 
#                                                                      # 
# The fact that you are presently reading this means that you have     # 
# had knowledge of the CeCILL-C license and that you accept its        # 
# terms.                                                               # 
#                                                                      # 
# Authors:                                                             # 
#   - PERACHE Marc marc.perache@cea.fr                                 # 
#                                                                      # 
######################################################################## 

decho(){
	echo "$0 DEBUG $@" > /dev/null
}
decho "$@"

if test "$#" != "6" ; then 
    echo "Wrong argument number"
    exit 1
fi

decho "Binary $1"
decho "MPC_ARGS $2"
decho "LAUNCHER_OPTION_BINARY_ARGS $3"

MPC_STARTUP_ARGS="$2"
export MPC_STARTUP_ARGS

MPC_SERVER_PORT="$4"
export MPC_SERVER_PORT
MPC_SERVER_HOST="$5"
export MPC_SERVER_HOST

if test "$6" != "0" ; then 
    MPC_AUTO_KILL_TIMEOUT="$6"
    export MPC_AUTO_KILL_TIMEOUT
fi 

trap "kill -s 2 0" INT

decho "EVAL $1 $3"
eval "$1 $3"
rc=$?
decho EXIT $rc
exit $rc
