#!/bin/sh
############################# MPC License ##############################
# Wed Nov 19 15:19:19 CET 2008                                         #
# Copyright or (C) or Copr. Commissariat a l Energie Atomique          #
#                                                                      #
# IDDN.FR.001.230040.000.S.P.2007.000.10000                            #
# This file is part of the MPC Runtime.                                #
#                                                                      #
# This software is governed by the CeCILL-C license under French law   #
# and abiding by the rules of distribution of free software.  You can  #
# use, modify and/ or redistribute the software under the terms of     #
# the CeCILL-C license as circulated by CEA, CNRS and INRIA at the     #
# following URL http://www.cecill.info.                                #
#                                                                      #
# The fact that you are presently reading this means that you have     #
# had knowledge of the CeCILL-C license and that you accept its        #
# terms.                                                               #
#                                                                      #
# Authors:                                                             #
#   - PERACHE Marc marc.perache@cea.fr                                 #
#   - CARRIBAULT Patrick patrick.carribault@cea.fr                     #
#                                                                      #
########################################################################

#
# Installation environment
#

MPC_INSTALL_PREFIX="@prefix@"
MPC_SHARE_DIR="@PKG_DATADIR@"

#
# Default compiler environmnent
#

MPC_DEFAULT_C_COMPILER="@MPC_DEFAULT_C_COMPILER@"
MPC_DEFAULT_CXX_COMPILER="@MPC_DEFAULT_CXX_COMPILER@"
MPC_DEFAULT_FC_COMPILER="@MPC_DEFAULT_FC_COMPILER@"

#
# Print Module list
#

# Module FLAGS
MPC_MODULE_LIST="@MPC_MODULE_LIST@"

print_mod_list()
{
	echo "${MPC_MODULE_LIST}"
}

gen_module_defines()
{
	RET=""

	for m in ${MPC_MODULE_LIST}
	do
		RET="$RET -D${m}"
	done

	echo $RET
}

#
# Generate Flags
#

OPA_CFLAGS="@OPA_CFLAGS@"
HWLOC_CFLAGS="@HWLOC_CFLAGS@"
EXTLS_CFLAGS="@EXTLS_CFLAGS@"
MPCALLOC_CFLAGS="@ALLOC_CFLAGS@"

FLAGS="-I@PKG_INCDIR@"

FLAGS="$FLAGS ${OPA_CFLAGS}"
FLAGS="$FLAGS ${HWLOC_CFLAGS}"
FLAGS="$FLAGS ${EXTLS_CFLAGS}"
FLAGS="$FLAGS ${MPCALLOC_CFLAGS}"

FLAGS="$FLAGS $(gen_module_defines)"

#
# Help
#

show_help()
{
	echo "mpc_cflags can be used to retrieve information on MPC's compilation flags"
	echo ""
	echo "mpc_cflags [-p] [-m] [-h]"
	echo ""
	echo " -h|--help    Print this help"
	echo " [NO ARGS]    Print cflags"
	echo ""
	echo "Install env:"
	echo " -p           Display mpc install prefix"
	echo " -s           Display mpc share directory"
	echo ""
	echo "Modules:"
	echo " -m           List compiled Modules"
	echo ""
	echo "Compilers:"
	echo " -cc          Print default C compiler"
	echo " -fc          Print default Fortran compiler"
	echo " -cxx|-cpp    Print default C++ compiler"
}

#
# Argument Parsing
#

for arg in "$@" ; do
	case $arg in
		# ----------------------------------------------------------------
		# Compiler options that affect whether we are linking or not
	-p)
		echo "$MPC_INSTALL_PREFIX"
		;;
	-s)
		echo "$MPC_SHARE_DIR"
		;;
	-m)
		print_mod_list
		;;
	-cc)
		echo "$MPC_DEFAULT_C_COMPILER"
		;;
	-fc)
		echo "$MPC_DEFAULT_FC_COMPILER"
		;;
	-cxx|-cpp)
		echo "$MPC_DEFAULT_CXX_COMPILER"
		;;
	*)
		show_help
		;;
	esac
done

if test "x$#" = "x0"; then
	echo "${FLAGS}"
fi